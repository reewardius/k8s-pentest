#!/bin/bash

# Get the list of all nodes in the cluster
nodes=$(kubectl get nodes -o jsonpath='{.items[*].metadata.name}')

# Loop through all nodes
for node in $nodes; do
  echo "Deleting logs for all pods on node $node"

  # Get the list of all pods on the node
  pods=$(kubectl get pods --field-selector spec.nodeName=$node -o jsonpath='{.items[*].metadata.name}')

  # Loop through all pods on the node
  for pod in $pods; do
    echo "  Deleting logs for pod $pod"
    kubectl logs $pod --since=1h | xargs -I {} rm {}
  done
done
