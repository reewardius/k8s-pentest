#!/bin/bash

# Get the list of nodes in the cluster
nodes=$(kubectl get nodes -o jsonpath='{.items[*].metadata.name}')

# Loop through each node
for node in $nodes; do
  # Get the list of pods running on the node
  pods=$(kubectl get pods --all-namespaces -o jsonpath="{.items[?(@.spec.nodeName=='$node')].metadata.name}" --field-selector spec.nodeName=${node})
  
  # Loop through each pod
  for pod in $pods; do
    # Get the list of containers in the pod
    containers=$(kubectl get pods $pod --namespace=default -o jsonpath='{.spec.containers[*].name}')

    # Loop through each container
    for container in $containers; do
      # Delete the logs for the container in the pod on the node
      kubectl logs $pod --namespace=default --container=$container --previous > /dev/null 2>&1
    done
  done
done
